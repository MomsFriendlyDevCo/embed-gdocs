{"mappings":";AAAA;;;;;;;;;;;;;;;;AAgBA,GACAA,OAAOC,SAAS,GAAG,SAASC,UAAUC,OAAO,EAAE;IAC9C,IAAIC,WAAW;QACdC,UAAU,IAAI;QACdC,KAAK,IAAI;QACTC,YAAY;YACXC,OAAO;YACPC,SAAS;gBACR,UAAU;YACX;QACD;QACAC,WAAW,IAAI;QACfC,gBAAgB,IAAI;QACpBC,UAAU,IAAI;QACdC,eAAe,IAAI;QACnBC,YAAY,IAAI;QAChBC,gBAAgB,IAAI;QACpBC,gBAAgB,IAAI;QACpBC,qBAAqB,IAAI;QACzB,GAAGd,OAAH;IACD;IACA,IAAI,CAACC,SAASC,QAAQ,EAAE,MAAM,IAAIa,MAAM,8BAAxC;IACA,IAAI,CAACd,SAASE,GAAG,EAAE,MAAM,IAAIY,MAAM,yBAAnC;IAEA,IAAIC,UAAU,OAAOf,SAASC,QAAQ,IAAI,WACvCe,SAASC,aAAa,CAACjB,SAASC,QAAQ,IACxCD,SAASC,QAAQ;IAEpB,IAAI,CAACc,SAAS,MAAM,IAAID,MAAO,CAAA,sBAAA,EAAwBd,SAASC,QAAS,CAAA,cAAA,CAAe,EAAxF;IAEA,OAAOiB,MAAMlB,SAASE,GAAG,EAAEF,SAASG,UAAU,EAC5CgB,IAAI,CAACC,CAAAA,MAAOA,IAAIC,IAAI,IACpBF,IAAI,CAACG,CAAAA,OAAQ;QACb,IAAIC,YAAYP,SAASQ,aAAa,CAAC;QACvC,IAAIC,aAAa,EAAE,EAAE,8CAArB;QACAF,UAAUG,OAAO,CAACJ,OAAO,gCAAzBC;QAEA,IAAII,MAAM3B,SAASO,cAAc,GAC9BgB,UAAUN,aAAa,CAAC,gBAAgB,mCAD3C;WAEGM,SAAS;QAEZ,IAAIvB,SAASM,SAAS,EAAE;YACvB,IAAIsB,QAAQL,UAAUN,aAAa,CAAC;YACpCY,QAAQC,GAAG,CAAC,kBAAkBF;YAC9BD,IAAII,OAAO,CAACH;QACb,CAAA;QAEA,iCAAA;QACA,IAAI5B,SAASQ,QAAQ,IAAIR,SAASU,UAAU,EAC3CiB,IAAIK,YAAY,CAAC,SAAS;YACzBhC,SAASQ,QAAQ,IAAI;YACrBR,SAASU,UAAU,IAAI;SACvB,CACCuB,MAAM,CAACC,SACPC,IAAI,CAAC;QAGR,MAAA;QACA,oBAAA;QACA,IAAInC,SAASS,aAAa,EACzBgB,WAAWW,IAAI,CACb,CAAA,EAAEpC,SAASC,QAAS,CAAA,wDAAA,CAAyD,EAAE,mCAAA;QAC/E,CAAA,EAAED,SAASC,QAAS,CAAA,+CAAA,CAAgD,CAAE,mCAAtE;;QAGH,MAAA;QACA,qBAAA;QACA,IAAID,SAASqC,cAAc,EAC1BZ,WAAWW,IAAI,CAAE,CAAA,EAAEpC,SAASC,QAAS,CAAA,0BAAA,CAA2B;QAEjE,MAAA;QACA,2CAAA;QACA,IAAID,SAASW,cAAc,IAAIX,SAASY,cAAc,EAAE;YAAA,IAAA;YACvD,wBAAAe,IAAIW,gBAAgB,CAAC,MACVC,MAAMC,IAAI,CAACC,uBACpBR,MAAM,CAACS,CAAAA,KAAM,eAAeC,IAAI,CAACD,GAAGE,YAAY,CAAC,UACjDC,OAAO,CAACH,CAAAA,KAAM;gBACd,iBAAA;gBACA,IAAI1C,SAASW,cAAc,EAAE+B,GAAGV,YAAY,CAAC,UAAU;gBAEvD,iBAAA;gBACA,IAAIhC,SAASY,cAAc,EAAE8B,GAAGV,YAAY,CAAC,QAAQU,GAAGE,YAAY,CAAC,QACnEE,OAAO,CAAC,iDAAiD,MAAM,uCADjE;iBAEEA,OAAO,CAAC,wCAAwC,IAAI,yBADW;;YAGlE,EAAE;QACJ,CAAA;QACA,MAAA;QACA,0BAAA;QACA,IAAI9C,SAASa,mBAAmB,EAAE;YAAA,IAAA;YACjC,yBAAAc,IAAIW,gBAAgB,CAAC,eACVC,MAAMC,IAAI,CAACC,wBACpBR,MAAM,CAACS,CAAAA,KAAM,eAAeC,IAAI,CAACD,GAAGE,YAAY,CAAC,WACjDC,OAAO,CAACH,CAAAA,KAAM;gBACd,IAAIK,UAAU/B,SAASQ,aAAa,CAAC;gBACrCuB,QAAQf,YAAY,CAAC,QAAQU,GAAGE,YAAY,CAAC;gBAC7C,IAAI5C,SAASW,cAAc,EAAEoC,QAAQf,YAAY,CAAC,UAAU;gBAE5DU,GAAGM,WAAW,CAACD;gBACfA,QAAQE,eAAe,CAACP;YACzB,EAAE;QACJ,CAAA;QACA,MAAA;QAEA,IAAIjB,WAAWyB,MAAM,GAAG,GAAG;YAAE,qCAAA;YAC5B,IAAIC,aAAanC,SAASQ,aAAa,CAAC;YACxC2B,WAAWnB,YAAY,CAAC,QAAQ;YAChCmB,WAAWzB,OAAO,CAACD,WAAWU,IAAI,CAAC;YACnCR,IAAII,OAAO,CAACoB;QACb,CAAA;QAEApC,QAAQkC,eAAe,CAACtB;IACzB;AACF","sources":["src/embed-gdocs.js"],"sourcesContent":["/**\n* Embed a Google-Docs document within a webpage\n* @param {Object} options Options to configure behaviour\n* @param {string|HTMLElement} options.selector Either the DOM node to replace or a selector to use\n* @param {string} options.url The Google Docs published URL to embed - this generally ends in `/pub?embedded=true`\n* @param {Object} [options.urlOptions] Additional Fetch options when retrieving the document from the `url`\n* @param {boolean} [options.keepStyle=true] Keep the source document style, if false this removes the style completely\n* @param {boolean} [options.fixContentTrim=true] Remove the outer wrapping of the element and just use the embedded content\n* @param {boolean} [options.fixWidth=true] Remove page width restrictions\n* @param {boolean} [options.fixParaMargins=true] Add slight margin to paragraphs\n* @param {boolean} [options.fixTableWidth=true] Remove table width restrictions\n* @param {boolean} [options.fixPadding=true] Remove page padding\n* @param {boolean} [options.fixLinkTargets=true] Make all links open in a new tab instead of replacing the current one\n* @param {boolean} [options.fixLinkShorten=true] Remove Google tracking URL prefix from links\n* @param {boolean} [options.fixImageTitleAsLink=true] If an image \"alternative text\" (actually the `title` attribute) looks like a link make the image linkable - this is to fix how Google Docs weirdly handles image linking\n*\n*/\nwindow.embedGDoc = function embedGdoc(options) {\n\tlet settings = {\n\t\tselector: null,\n\t\turl: null,\n\t\turlOptions: {\n\t\t\tcache: 'default',\n\t\t\theaders: {\n\t\t\t\t'Accept': 'text/html',\n\t\t\t},\n\t\t},\n\t\tkeepStyle: true,\n\t\tfixContentTrim: true,\n\t\tfixWidth: true,\n\t\tfixTableWidth: true,\n\t\tfixPadding: true,\n\t\tfixLinkTargets: true,\n\t\tfixLinkShorten: true,\n\t\tfixImageTitleAsLink: true,\n\t\t...options,\n\t};\n\tif (!settings.selector) throw new Error('Selector must be specified');\n\tif (!settings.url) throw new Error('URL must be specified');\n\n\tlet embedEl = typeof settings.selector == 'string'\n\t\t? document.querySelector(settings.selector)\n\t\t: settings.selector;\n\n\tif (!embedEl) throw new Error(`Cannot find selector \"${settings.selector} to embed GDoc`);\n\n\treturn fetch(settings.url, settings.urlOptions)\n\t\t.then(res => res.text())\n\t\t.then(html => {\n\t\t\tlet sourceDoc = document.createElement('div')\n\t\t\tlet styleRules = []; // Additional style rules to prepend when done\n\t\t\tsourceDoc.setHTML(html); // Splat HTML into temporary div\n\n\t\t\tlet doc = settings.fixContentTrim\n\t\t\t\t? sourceDoc.querySelector('.doc-content') // Narrow down to just the contents\n\t\t\t\t: sourceDoc\n\n\t\t\tif (settings.keepStyle) {\n\t\t\t\tlet style = sourceDoc.querySelector('style[type=\"text/css\"]');\n\t\t\t\tconsole.log('Reinject style', style);\n\t\t\t\tdoc.prepend(style);\n\t\t\t}\n\n\t\t\t// fixWidth and/or fixPadding {{{\n\t\t\tif (settings.fixWidth || settings.fixPadding) {\n\t\t\t\tdoc.setAttribute('style', [\n\t\t\t\t\tsettings.fixWidth && 'max-width: none',\n\t\t\t\t\tsettings.fixPadding && 'padding: 0 20px',\n\t\t\t\t]\n\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t.join(';\\n')\n\t\t\t\t);\n\t\t\t}\n\t\t\t// }}}\n\t\t\t// fixTableWidth {{{\n\t\t\tif (settings.fixTableWidth) {\n\t\t\t\tstyleRules.push(\n\t\t\t\t\t`${settings.selector} table { max-width: none !important; padding: 1.5rem 0 }`, // Let last table row max out width\n\t\t\t\t\t`${settings.selector} table td:last-child { width: auto !important }`, // Let last table row max out width\n\t\t\t\t);\n\t\t\t}\n\t\t\t// }}}\n\t\t\t// fixParaMargins {{{\n\t\t\tif (settings.fixParaMargins) {\n\t\t\t\tstyleRules.push(`${settings.selector} p { margin-bottom: 1rem }`);\n\t\t\t}\n\t\t\t// }}}\n\t\t\t// fixLinkTargets and/or fixLinkShorten {{{\n\t\t\tif (settings.fixLinkTargets || settings.fixLinkShorten) {\n\t\t\t\tdoc.querySelectorAll('a')\n\t\t\t\t\t|> els => Array.from(els)\n\t\t\t\t\t.filter(el => /^https?:\\/\\//.test(el.getAttribute('href')))\n\t\t\t\t\t.forEach(el => {\n\t\t\t\t\t\t// fixLinkTargets\n\t\t\t\t\t\tif (settings.fixLinkTargets) el.setAttribute('target', '_blank')\n\n\t\t\t\t\t\t// fixLinkShorten\n\t\t\t\t\t\tif (settings.fixLinkShorten) el.setAttribute('href', el.getAttribute('href')\n\t\t\t\t\t\t\t.replace(/^https:\\/\\/www\\.google\\.com\\/url\\?q=(.*?)&.*$/, '$1') // Remove `&...` slush from GitHub URLs\n\t\t\t\t\t\t\t.replace(/^https:\\/\\/www\\.google\\.com\\/url\\?q=/, '') // Rewrite all other URLs\n\t\t\t\t\t\t);\n\t\t\t\t\t});\n\t\t\t}\n\t\t\t// }}}\n\t\t\t// fixImageTitleAsLink {{{\n\t\t\tif (settings.fixImageTitleAsLink) {\n\t\t\t\tdoc.querySelectorAll('img[title]')\n\t\t\t\t\t|> els => Array.from(els)\n\t\t\t\t\t.filter(el => /^https?:\\/\\//.test(el.getAttribute('title')))\n\t\t\t\t\t.forEach(el => {\n\t\t\t\t\t\tlet wrapper = document.createElement('a');\n\t\t\t\t\t\twrapper.setAttribute('href', el.getAttribute('title'));\n\t\t\t\t\t\tif (settings.fixLinkTargets) wrapper.setAttribute('target', '_blank');\n\n\t\t\t\t\t\tel.replaceWith(wrapper);\n\t\t\t\t\t\twrapper.replaceChildren(el);\n\t\t\t\t\t})\n\t\t\t}\n\t\t\t// }}}\n\n\t\t\tif (styleRules.length > 0) { // Append any override styles we have\n\t\t\t\tlet styleSheet = document.createElement('style');\n\t\t\t\tstyleSheet.setAttribute('type', 'text/css');\n\t\t\t\tstyleSheet.setHTML(styleRules.join('\\n'));\n\t\t\t\tdoc.prepend(styleSheet);\n\t\t\t}\n\n\t\t\tembedEl.replaceChildren(doc);\n\t\t})\n}\n"],"names":["window","embedGDoc","embedGdoc","options","settings","selector","url","urlOptions","cache","headers","keepStyle","fixContentTrim","fixWidth","fixTableWidth","fixPadding","fixLinkTargets","fixLinkShorten","fixImageTitleAsLink","Error","embedEl","document","querySelector","fetch","then","res","text","html","sourceDoc","createElement","styleRules","setHTML","doc","style","console","log","prepend","setAttribute","filter","Boolean","join","push","fixParaMargins","querySelectorAll","Array","from","els","el","test","getAttribute","forEach","replace","wrapper","replaceWith","replaceChildren","length","styleSheet"],"version":3,"file":"module.js.map"}